{% extends "base.html" %}
{% block content %}

<html data-wf-page="650f57fbea23e1c17aa1ef4f" data-wf-site="650f57c238e964525a27dd3f" lang="en">
<link rel="stylesheet" type="text/css" href="../static/css/normalize.css">
<link rel="stylesheet" type="text/css" href="../static/css/webflow.css">
<link rel="stylesheet" type="text/css" href="../static/css/code-output.webflow.css">
<script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
<link href="../static/img/favicon.svg" rel="shortcut icon" type="image/x-icon">
<link href="../static/img/webclip.svg" rel="apple-touch-icon">



<style>

  .ui-autocomplete {
    z-index: 1050 !important; /* Bootstrap modals usually have a z-index of 1040 */
  }

  .like-button {
    cursor: pointer;
    background: none;
    border: none;
    font-size: 24px;
    outline: none;
  }

  .like-button.clicked {
    color: yellow;
    text-shadow: 0 0 2px #000;
  }

  .card-body {
    font-size: 13px;
    line-height: 1.4em;
  }

  .card-status-alert {
    background-color: #910606;
    border-radius: 15px;
    padding: 5px 10px;
    color: white;
    font-weight: 500;
    text-align: center;
    margin-left: auto; /* This pushes the alert to the right side */
  }

  .card-status-summary {
    background-color: #0b6c0b;
    border-radius: 15px;
    padding: 5px 10px;
    color: white;
    font-weight: 500;
    text-align: center;
    margin-left: auto;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .date {
    font-weight: bold;
  }




  .nav {
    display: block!important;
    padding-left: 15px!important;
    margin-bottom: 15px;
    /*list-style: disc inside;*/
  }

 #myTab.nav.nav-tabs{
    display: flex!important;
  }


  .table-main-container tr{
    display: table;
    width: 100%;
    table-layout: fixed;  /* This ensures that the table takes up the full width */
  }

  .table-main-container th,
  .table-main-container td {
    display: table-cell;
    vertical-align: center;
    padding-left: 5px;
  }

  .table-scroll-container {
    overflow-x: auto;  /* Enable horizontal scrolling */
  }

  .table-main-container {
    min-width: 1200px;  /* Adjust this value to your preference */
  }

  /* Styles for the modal */
  .notes-modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }

  .notes-modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 50%;
  }

  .close-button {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close-button:hover,
  .close-button:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  /* Styles for the notes section in table */
  .notes-cell .paragraph-small.color-neutral-100 {
    background-color: lightslategrey;
    height: 90%;          /* slightly less than full height to give some padding effect */
    width: 90%;           /* slightly less than full width to give some padding effect */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    border: 2px solid white;   /* adds a border */
    border-radius: 5px;        /* rounds the corners */
    transition: transform 0.2s, box-shadow 0.2s; /* smoothens the hover effect */
    /*box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);    !* adds a subtle shadow *!*/
    text-align: center;        /* ensures text is centered */
    padding: 5px;              /* provides some space around the text */
  /*  create a fixed height so that any extra text inside gets trimmed on display*/
    max-height: 28px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .notes-cell .paragraph-small.color-neutral-100:hover {
    transform: translateY(-1px);    /* gives a subtle lift effect on hover */
    /*box-shadow: 0 4px 7px rgba(0, 0, 0, 0.3);   !* darkens the shadow a bit on hover *!*/
  }

  .sql-cell .paragraph-small.color-neutral-100 {
    background-color: lightslategrey;
    height: 90%;          /* slightly less than full height to give some padding effect */
    width: 90%;           /* slightly less than full width to give some padding effect */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    border: 2px solid white;   /* adds a border */
    border-radius: 5px;        /* rounds the corners */
    transition: transform 0.2s, box-shadow 0.2s; /* smoothens the hover effect */
    /*box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);    !* adds a subtle shadow *!*/
    text-align: center;        /* ensures text is centered */
    padding: 5px;              /* provides some space around the text */
  }

  .sql-cell .paragraph-small.color-neutral-100:hover {
    transform: translateY(-1px);    /* gives a subtle lift effect on hover */
    /*box-shadow: 0 4px 7px rgba(0, 0, 0, 0.3);   !* darkens the shadow a bit on hover *!*/
  }

  /* Styles for active column header */
  .sort-active {
    position: relative;

  }
  .sort-active div {
    font-weight: 800;
    text-transform: uppercase;

  }


  /* Styles for ascending & descending indicators */
  .sort-indicator {
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 12px;
  }

  .sort-asc::after {
    content: "↑";
  }

  .sort-desc::after {
    content: "↓";
  }

  table th:hover {
    cursor: pointer;
  }

  .parent-top-right {
    position: absolute;
    top: 0;
    right: 0;
  }

  .small-dropdown-link.w-dropdown-link {
    background-color: transparent;
    transition: background-color 0.3s, color 0.3s;
  }

  .small-dropdown-link.w-dropdown-link:hover {
    color: white;
    font-weight: bold;
  }


  .w-dropdown-list {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
  }

  .show-dropdown {
    display: block;
  }

  .recommendation-card, .event-card, .alert-card, .meeting-card {
    border: 1px solid #e0e0e0;
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
    /*background-color: #f9f9f9;*/
  }

  .date-container {
    /*display: flex;*/
    flex-direction: column;
    align-items: center;
    margin-right: 20px;
  }

  .event-day {
    background-color: #000; /* adjust color as needed */
    color: #fff; /* adjust color as needed */
    border-radius: 50%; /* makes it round */
    width: 50px; /* adjust size as needed */
    height: 50px; /* adjust size as needed */
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2em; /* adjust font size as needed */
    font-weight: bold;
    margin-bottom: 5px;
  }

  .event-month {
    font-size: 1.2em; /* adjust font size as needed */
    font-weight: bold;
    text-transform: uppercase;
    padding-left: 4px;
  }

  .event-item {
    padding: 16px;
    margin: 16px 0;
    border-bottom: 1px solid #000; /* You can adjust the color to your liking */
  }

  .event-item h2 {
    font-size: 2em;
    margin: 0;
  }

  .event-item h3 {
    font-size: 1.5em;
    margin: 0.5em 0;
  }

  .event-item p {
    font-size: 1.2em;
  }

  .floating-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: blue;
    color: white;
    border: none;
    border-radius: 50%;
    width: 70px;
    height: 70px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 9999;
  }

  .floating-button i {
    color: white;
    font-size: 24px;
  }






</style>

<body class="body">
  <div class="page-wrapper-2">
    <div class="dashboard-main-section">
      <div class="dashboard-content">
        <div class="dashboard-main-content">
          <div class="container-default w-container">
            <div class="mg-bottom-32px">
              <div class="_2-items-wrap-container">
                <div id="w-node-be246f26-a62f-48d4-76dd-5d34ac0a0daa-7aa1ef4f">
                  {% if user %}
                  <h1 class="display-4 mg-bottom-4px">Welcome back, {{user.username}}</h1>
                  {% else %}
                  <h1 class="display-4 mg-bottom-4px">Welcome back!</h1>
                  {% endif %}
                  <p class="mg-bottom-0">Measure your sales ROI on your Tier 1 accounts.</p>
                </div>

                <div>
                  <div class="dropdown-container" style="position: relative">
                    <div data-hover="true" data-delay="0" data-w-id="9cc462d8-bb30-3faf-01e2-89a59eb05ad4" class="mg-sides-0 position-relative---z-index-1 w-dropdown">
                      <div class="small-dropdown-toggle w-dropdown-toggle">
                        <div class="flex align-center gap-column-4px">
                          <div class="dashlight-custom-icon line-height-1em"></div>
                          <div class="text-65 medium">Select Date Range</div>
                        </div>
                        <div class="line-rounded-icon card-dropdown-arrow"></div>
                      </div>
                      <nav class="w-dropdown-list">
                        <div class="small-dropdown-links-container" style="background: white; border: white;">
                          <form action="{{ url_for('views.dash') }}" method="post">
                            <button class="small-dropdown-link w-dropdown-link" name="time_period" value="7" style="color: black; font-size: 15px">Close in 7 days</button>
                            <button class="small-dropdown-link w-dropdown-link" name="time_period" value="30" style="color: black; font-size: 15px">Close in 30 days</button>
                            <button class="small-dropdown-link w-dropdown-link" name="time_period" value="90" style="color: black; font-size: 15px">Close in 3 months</button>
                            <button class="small-dropdown-link w-dropdown-link" name="time_period" value="365" style="color: black; font-size: 15px">Close in 1 year</button>
                          </form>
                        </div>
                      </nav>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="mg-bottom-16px">
              <div class="small-details-card-grid">
                <div id="w-node-be246f26-a62f-48d4-76dd-5d34ac0a0dbe-7aa1ef4f" class="card top-details">
                  <div class="flex-horizontal justify-space-between">
                    <div class="flex align-center gap-column-4px"><img src="../static/img/pageviews-icon-dashdark-webflow-template.svg" loading="eager" alt="Open Opps - ARRPlan" class="max-h-16px">
                      <div class="text-100 medium mg-top-2px">Open Opportunities</div>
                    </div>
                    <div class="dashdark-custom-icon details-icon"></div>
                  </div>



                  <div class="flex align-center gap-column-6px">
                    <div class="display-4">
                      {% if total_open > 1000000 %}
                      ${{ total_open/1000000 }}M
                      {% elif total_open > 1000 %}
                      ${{ total_open/1000 }}K
                      {% else %}
                      ${{ total_open }}
                      {% endif %}
                    </div>
                    <div>
                      <div class="status-badge green">
                        <div class="flex align-center gap-column-4px">
                          <div class="paragraph-small">28.4%</div>
                        </div>
                        <div class="dashdark-custom-icon icon-size-9px">^</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div id="w-node-be246f26-a62f-48d4-76dd-5d34ac0a0dd9-7aa1ef4f" class="card top-details">
                  <div class="flex-horizontal justify-space-between">
                    <div class="flex align-center gap-column-4px"><img src="../static/img/monthly-users-icon-dashdark-webflow-template.svg" loading="eager" alt="Lost Deals - ARRPlan" class="max-h-16px">
                      <div class="text-100 medium mg-top-2px">Ask A Question</div>
                    </div>
                    <div class="dashdark-custom-icon details-icon"></div>
                  </div>
                  <div class="flex align-center gap-column-6px">
                    <div class="display-4 sql">{{ ask_sql }}</div>
                    <div>
<!--                      <div class="status-badge red">-->
<!--                        <div class="flex align-center gap-column-4px">-->
<!--                          <div class="paragraph-small">12.6%</div>-->
<!--                        </div>-->
<!--                        <div class="dashdark-custom-icon icon-size-9px">v</div>-->
<!--                      </div>-->
                    </div>
                  </div>
                  <div class="sql-cell">
                    <div class="paragraph-small color-neutral-100" id="openSqlModal">How many accounts have a score over 50 total?</div>
                  </div>

                </div>
                <div id="w-node-be246f26-a62f-48d4-76dd-5d34ac0a0df4-7aa1ef4f" class="card top-details">
                  <div class="flex-horizontal justify-space-between">
                    <div class="flex align-center gap-column-4px"><img src="../static/img/new-sign-ups-icon-dashdark-webflow-template.svg" loading="eager" alt="ARRPlan" class="max-h-16px">
                      <div class="text-100 medium mg-top-2px"> Tier 1 Interactions</div>
                    </div>
                    <div class="dashdark-custom-icon details-icon"></div>
                  </div>
                  <div class="flex align-center gap-column-6px">
                    <div class="display-4">{{tier1}}</div>
                    <div>
                      <div class="status-badge green">
                        <div class="flex align-center gap-column-4px">
                          <div class="paragraph-small">3.1%</div>
                        </div>
                        <div class="dashdark-custom-icon icon-size-9px">^</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div id="w-node-be246f26-a62f-48d4-76dd-5d34ac0a0e0f-7aa1ef4f" class="card top-details">
                  <div class="flex-horizontal justify-space-between">
                    <div class="flex align-center gap-column-4px"><img src="../static/img/subscriptions-icon-dashdark-webflow-template.svg" loading="eager" alt="Subscriptions - Dashdark X Webflow Template" class="max-h-16px">
                      <div class="text-100 medium mg-top-2px">Closed Revenue</div>
                    </div>
                    <div class="dashdark-custom-icon details-icon"></div>
                  </div>
                  <div class="flex align-center gap-column-6px">
                    <div class="display-4">
                      {% if total_closed > 1000000 %}
                      ${{ total_closed/1000000 }}M
                      {% elif total_closed > 1000 %}
                      ${{ total_closed/1000 }}K
                      {% else %}
                      ${{ total_closed }}
                      {% endif %}

                    </div>
                    <div>
                      <div class="status-badge green">
                        <div class="flex align-center gap-column-4px">
                          <div class="paragraph-small">11.3%</div>
                        </div>
                        <div class="dashdark-custom-icon icon-size-9px">^</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="mg-bottom-24px">
              <div class="_2-items-wrap-container align-end">
                <div>
                  <h2 class="display-4">Dashboard</h2>
                  <div data-hover="true" data-delay="0" class="mg-sides-0 position-relative---z-index-1 w-dropdown">
                  </div>
                </div>
                <div class="buttons-row">
                  <a href="#" class="btn-secondary w-inline-block">
                    <div class="flex-horizontal gap-column-6px">
                      <div>Export data</div><img src="../static/img/downward-arrow-btn-icon-dashdark-webflow-ecommerce-template.svg" loading="eager" alt="" class="btn-icon-right max-h-12px">
                    </div>
                  </a>
                  <a href="#" class="btn-primary w-inline-block">
                    <div class="flex-horizontal gap-column-6px">
                      <div>Create report</div>
                    </div>
                  </a>
                </div>
              </div>
            </div>
            <!--            TABS NAVIGATION-->
            <ul class="nav nav-tabs text-300 medium color-neutral-100" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Accounts</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Co-Sell</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">Feed</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="marketing-tab" data-bs-toggle="tab" data-bs-target="#marketing" type="button" role="tab" aria-controls="marketing" aria-selected="false">Marketing</button>
              </li>
            </ul>

            <!--            TABS CONTENT-->
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <!--                ACCOUNTS TAB-->
                <div class="mg-bottom-24px">
                  <div class="grid-2-columns gap-20px">
                    <div id="w-node-_38b4a65e-7f82-4f13-d3fc-261e38ea4042-ea54d9ce">
                      <div id="w-node-_28f58b49-e289-bfad-3672-3ddb30359092-30359092" class="grid-1-column">
                        <div class="card overflow-hidden">
                          <div class="_2-items-wrap-container pd-32px---28px">
                            <div class="text-300 medium color-neutral-100">Account List</div>
                            <div data-hover="true" data-delay="0" data-w-id="9cc462d8-bb30-3faf-01e2-89a59eb05ad4" class="mg-sides-0 position-relative---z-index-1 w-dropdown">
                              <div class="small-dropdown-toggle w-dropdown-toggle">
                                <div class="flex align-center gap-column-4px">
                                  <div class="dashdark-custom-icon line-height-1em"></div>
                                  <div class="text-50 medium">Jan 2024</div>
                                </div>
                                <div class="line-rounded-icon card-dropdown-arrow"></div>
                              </div>
                              <nav class="small-dropdown-list w-dropdown-list">
                                <div class="small-dropdown-links-container">
                                  <a href="#" class="small-dropdown-link w-dropdown-link">Dec 2023</a>
                                  <a href="#" class="small-dropdown-link w-dropdown-link">Nov 2023</a>
                                  <a href="#" class="small-dropdown-link w-dropdown-link">Oct 2023</a>
                                </div>
                              </nav>
                            </div>
                          </div>
                          <div class="table-scroll-container">
                            <!--          START OF ACCOUNT TABLE-->
                            <table class="table-main-container" id="accountsTable">
                              <thead>
                              <tr class="recent-orders-table-row table-header">
                                <!-- COLUMN 1 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <img src="../static/img/order-table-header-icon-dashdark-webflow-template.svg" alt="">
                                    <div class="text-50 semibold color-neutral-100" title="Lorem ipsum dolor sit amet, consectetur adipiscing elit.">Account Name</div>
                                  </div>
                                </th>
                                <!-- COLUMN 2 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                                    <div class="text-50 semibold color-neutral-100">Score</div>
                                  </div>
                                </th>
                                <!-- COLUMN 2B HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                                    <div class="text-50 semibold color-neutral-100">Tier</div>
                                  </div>
                                </th>
                                <!-- COLUMN 3 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                                    <div class="text-50 semibold color-neutral-100">State</div>
                                  </div>
                                </th>
                                <!-- COLUMN 4 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                                    <div class="text-50 semibold color-neutral-100">Industry</div>
                                  </div>
                                </th>
                                <!-- COLUMN 5 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                                    <div class="text-50 semibold color-neutral-100">Notes</div>
                                  </div>
                                </th>
                                <!-- COLUMN 6 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <img src="../static/img/status-table-header-icon-dashdark-webflow-template.svg" alt="">
                                    <div class="text-50 semibold color-neutral-100">Account ID</div>
                                  </div>
                                </th>
                                <!-- COLUMN 7 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <div class="text-50 semibold color-neutral-100">Top Contacts</div>
                                  </div>
                                </th>
                                <!-- COLUMN 8 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <div class="text-50 semibold color-neutral-100">Last Interaction</div>
                                  </div>
                                </th>
                                <!-- COLUMN 9 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <div class="text-50 semibold color-neutral-100">TAM</div>
                                  </div>
                                </th>
                                <!-- COLUMN 10 HEADER -->
                                <th>
                                  <div class="flex align-center gap-column-6px">
                                    <div class="text-50 semibold color-neutral-100">Focus</div>
                                  </div>
                                </th>

                              </tr>
                              </thead>
                              <tbody>
                              {% for account in accounts %}
                              <tr class="recent-orders-table-row">
                                <!-- COLUMN 1 -->
                                <td>
                                  <div class="flex align-center">
                                    <div class="paragraph-small color-neutral-100 account-name-tooltip" data-bs-toggle="tooltip" data-account-id="{{ account.Id }}" data-bs-placement="right" title="Loading...">
                                      {{ account.Name }}
                                    </div>
                                  </div>
                                </td>
                                <!-- COLUMN 2 -->
                                <td>
                                  <div class="flex align-center">
                                    <div class="paragraph-small color-neutral-100 account-score-tooltip" data-bs-toggle="tooltip" data-account-id="{{ account.Id }}" data-bs-placement="right" title="Loading...">
                                      {{ account.Score }}
                                    </div>
                                  </div>
                                </td>

<!--                                <td>-->
<!--                                  <div class="account-score-tooltip" data-bs-toggle="tooltip" title='<h2>{{account.Name}} Score</h2><hr><ul><li>Score: {{ account.Score }} </li><li>Tier: {{ tier1 }}</li><li>Sed do eiusmod tempor incididunt.</li></ul><button>Insights</button>' class="flex align-center">-->
<!--                                    <div class="paragraph-small color-neutral-100">{{ account.Score }}</div>-->
<!--                                  </div>-->
<!--                                </td>-->

                                <!-- COLUMN 2B -->
                                <td>
                                  <div>
                                    <div class="dropdown-container" style="position: relative;">
                                      <div data-hover="true" data-delay="0" class="mg-sides-0 position-relative---z-index-1 w-dropdown">
                                        <div class="small-dropdown-toggle w-dropdown-toggle" style="font-size: 12px; height: 28px;">
                                          <div class="flex align-center gap-column-4px">
                                            <div class="dashlight-custom-icon line-height-1em"></div>
                                            <div class="text-65 medium" style="text-align: center">
                                              {% if account.Rank %}
                                              {{ account.Rank }}
                                              {% else %}
                                              Select Tier
                                              {% endif %}
                                            </div>
                                          </div>
                                          <div class="line-rounded-icon card-dropdown-arrow"></div>
                                        </div>

                                        <nav class="w-dropdown-list">
                                          <div class="small-dropdown-links-container" style="background: white; border: white;">
                                            <form method="post">
                                              <button class="small-dropdown-link w-dropdown-link" data-account-id="{{ account.Id }}" name="tier" value="1" style="color: black; font-size: 12px;">1</button>
                                              <button class="small-dropdown-link w-dropdown-link" data-account-id="{{ account.Id }}" name="tier" value="2" style="color: black; font-size: 12px;">2</button>
                                              <button class="small-dropdown-link w-dropdown-link" data-account-id="{{ account.Id }}" name="tier" value="3" style="color: black; font-size: 12px;">3</button>
                                              <button class="small-dropdown-link w-dropdown-link" data-account-id="{{ account.Id }}" name="tier" value="4" style="color: black; font-size: 12px;">4</button>
                                              <button class="small-dropdown-link w-dropdown-link" data-account-id="{{ account.Id }}" name="tier" value="Customer" style="color: black; font-size: 12px;">Customer</button>
                                            </form>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>

                                  </div>

                                </td>


                                <!-- COLUMN 3 -->
                                <td>
                                  <div class="flex align-center">
                                    <div class="paragraph-small color-neutral-100">{{ account.BillingState }}</div>
                                  </div>
                                </td>
                                <!-- COLUMN 4 -->
                                <td>
                                  <div class="flex align-center">
                                    <div class="paragraph-small color-neutral-100">{{ account.Industry }}</div>
                                  </div>
                                </td>
                                <!-- COLUMN 5 -->
                                <td class="notes-cell">
                                  <div class="flex align-center">
                                    <div class="paragraph-small color-neutral-100 notes-tooltip"
                                         data-account-id="{{ account.Id }}"
                                         data-bs-toggle="tooltip"
                                         data-bs-placement="top"
                                         title="{{ account.Notes }}">
                                      {{ account.Notes }}
                                    </div>

                                  </div>
                                </td>

                                <!-- COLUMN 6 -->
                                <td>
                                  <div class="flex align-center">
                                    <div class="status-badge green">
                                      <div class="flex align-center gap-column-4px">
                                        <div class="small-dot _4px bg-green-300"></div>
                                        <div class="paragraph-small">{{ account.Id }}</div>
                                      </div>
                                    </div>
                                  </div>
                                </td>
                                <!-- COLUMN 7 -->
                                <td>
                                  <div class="flex align-center">
                                    <div class="paragraph-small color-neutral-100"><a href="#">{{ contact_count[account.Id] }}</a></div>
                                  </div>
                                </td>

                                <!-- COLUMN 8 -->
                                <td>
                                  <div class="flex align-center">
                                    <div class="paragraph-small color-neutral-100">
                                      {% set last_call = get_last_call(account.Id) %}
                                      {% set last_meeting = get_last_meeting(account.Id) %}
                                      {% set last_opp = get_last_opp(account.Id) %}

                                      {% if last_call or last_meeting or last_opp %}
                                      📞{{ last_call if last_call else 'N/A' }}/📧{{ last_meeting if last_meeting else 'N/A' }}/💰{{ last_opp if last_opp else 'N/A' }}
                                      {% else %}
                                      :(
                                      {% endif %}
                                    </div>
                                  </div>
                                </td>
                                <!-- COLUMN 9 -->
                                <td>
                                  <div class="flex align-center">
                                    <div class="paragraph-small color-neutral-100">
                                      {% if account.NumberOfEmployees is none %}
                                      $0
                                      {% else %}
                                      {% set tam = account.NumberOfEmployees * 1000 %}
                                      ${{ "{:,.0f}".format(tam) }}
                                      {% endif %}
                                    </div>
                                  </div>
                                </td>
                                <!-- COLUMN 10 -->
                                <td>
                                  <div class="flex align-center">
                                    <button class="like-button {% if account.Id in focused_accounts %}clicked{% endif %}" data-account-id="{{ account.Id }}">
<!--                                      &#9734; &lt;!&ndash; Unicode for empty star &ndash;&gt;-->
                                      &#9733; <!-- Unicode for filled star -->
<!--                                      &#1422;-->
<!--                                      &#1758;-->
<!--                                      &#128176;-->
<!--                                      &#9091;-->
                                    </button>
                                  </div>
                                </td>


                              </tr>
                              {% endfor %}
                              </tbody>
                            </table>
                          </div>

                          <!--          END OF ACCOUNT TABLE-->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Notes Modal -->
              <div id="notesModal" class="modal fade" tabindex="-1" aria-labelledby="notesModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="notesModalLabel" style="color: #0a163c">Edit Notes</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <textarea id="notesText" class="form-control" rows="5"></textarea>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                      <button id="saveNotes" type="button" class="btn btn-primary">Save changes</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Invitation Modal -->
              <div class="modal fade" id="invitationModal" tabindex="-1" aria-labelledby="invitationModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="invitationModalLabel">Send Invitations</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="invitationModalBody">
                      <!-- Cards of contacts will be dynamically added here -->
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                      <button type="button" id="sendInvitations" class="btn btn-primary">Send Invitations</button>
                    </div>
                  </div>
                </div>
              </div>



              <!--              TAB 2-->
              <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
              <div class="_2-items-wrap-container pd-32px---28px">Co-Sell</div>
                <div class="table-scroll-container">
                  <!--          START OF COSELL TABLE-->
                  <table class="table-main-container" id="coSellTable">
                    <thead>
                    <tr class="recent-orders-table-row table-header">
                      <!-- COLUMN 1 HEADER -->
                      <th>
                        <div class="flex align-center gap-column-6px">
                          <img src="../static/img/order-table-header-icon-dashdark-webflow-template.svg" alt="">
                          <div class="text-50 semibold color-neutral-100" title="Lorem ipsum dolor sit amet, consectetur adipiscing elit.">Account Name</div>
                        </div>
                      </th>

                      <!-- TAB 2 COLUMN 2 HEADER -->
                      <th>
                        <div class="flex align-center gap-column-6px">
                          <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                          <div class="text-50 semibold color-neutral-100">VAR</div>
                        </div>
                      </th>
                      <!-- TAB 2 COLUMN 3 HEADER -->
                      <th>
                        <div class="flex align-center gap-column-6px">
                          <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                          <div class="text-50 semibold color-neutral-100">PARTNER</div>
                        </div>
                      </th>
                      <!-- TAB 2 COLUMN 4 HEADER -->
                      <th>
                        <div class="flex align-center gap-column-6px">
                          <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                          <div class="text-50 semibold color-neutral-100">RESELLER</div>
                        </div>
                      </th>
                      <!-- TAB 2 COLUMN 5 HEADER -->
                      <th>
                        <div class="flex align-center gap-column-6px">
                          <img src="../static/img/date-table-header-icon-dashdark-webflow-template.svg" alt="">
                          <div class="text-50 semibold color-neutral-100">OTHER</div>
                        </div>
                      </th>


                    </tr>
                    </thead>
                    <tbody>
                    {% for account in accounts %}
                    <tr class="recent-orders-table-row">
                      <!-- TAB 2 COLUMN 1 -->
                      <td>
                        <div class="flex align-center">
                          <div class="paragraph-small color-neutral-100 account-name-tooltip" data-bs-toggle="tooltip" data-account-id="{{ account.Id }}" data-bs-placement="right" title="Loading...">
                            {{ account.Name }}
                          </div>
                        </div>
                      </td>

                      <!-- TAB 2 COLUMN 2 COSELL -->
                      <td class="notes-cell">
                        <div class="flex align-center">
                          <div class="paragraph-small color-neutral-100 notes-tooltip"
                               data-account-id="{{ account.Id }}"
                               data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="{{ account.Notes }}">
                            {{ account.Notes }}
                          </div>

                        </div>
                      </td>
                      <!-- TAB 2 COLUMN 3 COSELL -->
                      <td class="notes-cell">
                        <div class="flex align-center">
                          <div class="paragraph-small color-neutral-100 notes-tooltip"
                               data-account-id="{{ account.Id }}"
                               data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="{{ account.Notes }}">
                            {{ account.Notes }}
                          </div>

                        </div>
                      </td>
                      <!-- TAB 2 COLUMN 4 COSELL -->
                      <td class="notes-cell">
                        <div class="flex align-center">
                          <div class="paragraph-small color-neutral-100 notes-tooltip"
                               data-account-id="{{ account.Id }}"
                               data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="{{ account.Notes }}">
                            {{ account.Notes }}
                          </div>

                        </div>
                      </td>
                      <!-- TAB 2 COLUMN 5 COSELL -->
                      <td class="notes-cell">
                        <div class="flex align-center">
                          <div class="paragraph-small color-neutral-100 notes-tooltip"
                               data-account-id="{{ account.Id }}"
                               data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="{{ account.Notes }}">
                            {{ account.Notes }}
                          </div>

                        </div>
                      </td>

                    </tr>
                    {% endfor %}
                    </tbody>
                  </table>
                </div>

              </div>

              <!--              TAB 3-->
              <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                <div id="feedContainer">
                  <!-- Feed items will be appended here -->
                </div>
                <div id="loadingIndicator" style="display: none;">
<!--                  Loading more items...-->
                </div>
              </div>

              <!-- TAB 4 Marketing Tab -->
              <div class="tab-pane fade" id="marketing" role="tabpanel" aria-labelledby="marketing-tab">
                <br>
                <!-- Anchor styled as a button -->
                <a href="{{ url_for('events.events_page') }}" class="btn btn-primary">Go to Events Page</a>
                <!-- Your events content will go here -->
                <div id="eventContainer">
                  <!-- Events will be appended here -->
                </div>
              </div>


            </div>

          </div>
        </div>
      </div>

      <!-- Floating Button -->
      <button id="callButton" class="floating-button">
        <i class="fas fa-phone-alt"></i>
      </button>

      <!--  Call Setup Modal    -->
      <div class="modal fade" id="callSetupModal" tabindex="-1" aria-labelledby="callSetupModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="callSetupModalLabel">Call Setup</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div>Name: <span id="contactName"></span></div>
              <div>Account ID: <span id="contactAccountId"></span></div>
              <div>Contact ID: <span id="contactId"></span></div>
              <div>Phone Number: <span id="contactPhone"></span></div>
              <div>
                <label>Record Call: </label>
                <input type="checkbox" id="recordCall" checked>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" id="startCallButton">Call</button>
            </div>
          </div>
        </div>
      </div>


      <!-- Call Modal -->
      <div class="modal fade" id="callModal" tabindex="-1" aria-labelledby="callModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="callModalLabel">New Call</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <input type="text" class="form-control" id="contactSearch" placeholder="Search for contacts...">
              <!-- Autocomplete options will appear here -->
            </div>
          </div>
        </div>
      </div>


      <!-- SQL Modal -->
      <div id="sqlModal" class="modal fade" tabindex="-1" aria-labelledby="sqlModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="sqlModalLabel" style="color: #0a163c">Enter Your Query</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <textarea id="sqlQueryInput" class="form-control" rows="4"></textarea>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button id="saveSqlQuery" type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>



    </div>
  </div>


<!--  <div class="loading-bar-wrapper">-->
<!--    <div class="loading-bar"></div>-->
<!--  </div>-->


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=650b5aa1c83014362c816d0e" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../static/js/webflow.js" type="text/javascript"></script>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=650f57c238e964525a27dd3f" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <script>
    // Get the modal, close button, and save button elements
    var notesModal = new bootstrap.Modal(document.getElementById('notesModal'), {
      keyboard: true
    });

    // Open the modal when the notes section is double-clicked
    var notesElements = document.querySelectorAll(".notes-cell .paragraph-small.color-neutral-100");
    var currentAccountId;

    // Open the modal when the notes section is clicked
    notesElements.forEach(function(noteElement) {
      noteElement.addEventListener("click", function() {
        currentAccountId = this.getAttribute("data-account-id");
        currentNoteElement = this; // Store the reference to the clicked element
        document.getElementById("notesText").value = this.innerText;
        notesModal.show();
      });
    });

    document.getElementById("saveNotes").addEventListener("click", function() {
      var noteText = document.getElementById("notesText").value;

      fetch("/save_notes", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
          "account_id": currentAccountId,
          "note_text": noteText
        })
      })
              .then(response => response.json())
              .then(data => {
                if(data.status === "success") {
                  currentNoteElement.innerText = noteText; // Update the note in the table
                  notesModal.hide(); // Close the modal
                } else {
                  // Handle error
                  console.error("Error updating notes:", data.message);
                }
              })
              .catch(error => {
                console.error("Error:", error);
              });
    });




  </script>
  <script>
    <!--    tooltips-->
    $(document).ready(function() {
      // Initialize tooltip for Notes
      var notesTooltipList = [].slice.call(document.querySelectorAll('.notes-tooltip'));
      var notesTooltipInstances = notesTooltipList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl, {
          html: true
        });
      });

      // Initialize tooltip for Account Names and fetch data on hover
      var accountNameTooltipList = [].slice.call(document.querySelectorAll('.account-name-tooltip'));
      var accountNameTooltipInstances = accountNameTooltipList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl, {
          html: true
        });
      });

      var accountScoreTooltipList = [].slice.call(document.querySelectorAll('.account-score-tooltip'));
      var accountScoreTooltipInstances = accountScoreTooltipList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl, {
          html: true
        });
      });


      // var accountScoreTooltipList = [].slice.call(document.querySelectorAll('.account-score-tooltip'));
      // var accountScoreTooltipInstances = accountScoreTooltipList.map(function (tooltipTriggerEl) {
      //   return new bootstrap.Tooltip(tooltipTriggerEl, {
      //     html: true
      //   });
      // });

      $('.account-name-tooltip').on('mouseenter', function() {
        var accountId = $(this).attr('data-account-id');
        var currentElement = $(this);

        // Fetch account details using AJAX
        $.get(`/account/${accountId}`, function(data) {
          currentElement.attr('data-bs-original-title', data);
          currentElement.tooltip('update');
        });
      });

      $('.account-score-tooltip').on('mouseenter', function() {
        var accountId = $(this).attr('data-account-id');
        var currentElement = $(this);

        // Fetch account details using AJAX
        $.get(`/tier/${accountId}`, function(data) {
          currentElement.attr('data-bs-original-title', data);
          currentElement.tooltip('update');
        });
      });

    });
  </script>

  <script>
    // Function to sort table
    function sortTable(table, columnIndex, ascending = true) {
      const tbody = table.querySelector("tbody");
      const rows = Array.from(tbody.querySelectorAll("tr"));

      // Sort rows based on content of specified column
      const sortedRows = rows.sort((a, b) => {
        const aValue = a.cells[columnIndex].innerText.trim();
        const bValue = b.cells[columnIndex].innerText.trim();

        if (!isNaN(aValue) && !isNaN(bValue)) {
          return ascending ? parseFloat(aValue) - parseFloat(bValue) : parseFloat(bValue) - parseFloat(aValue);
        } else {
          return ascending ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
        }
      });

      // Append sorted rows back to the table
      tbody.innerHTML = "";
      sortedRows.forEach(row => tbody.appendChild(row));
    }

    // Attach event listener to each header
    document.addEventListener("DOMContentLoaded", function() {
      const table = document.getElementById("accountsTable");
      const headers = Array.from(table.querySelectorAll("thead th"));
      let ascending = true;

      headers.forEach((header, index) => {
        header.addEventListener("click", () => {
          // Remove active class from all headers
          headers.forEach(h => h.classList.remove("sort-active", "sort-asc", "sort-desc"));

          // Apply the active class to the clicked header
          header.classList.add("sort-active");

          // Call the sort function
          sortTable(table, index, ascending);
          ascending = !ascending; // Toggle the sorting direction
        });
      });

    });
  </script>

  <script>
    $(document).ready(function() {
      $("#recalculateButton").click(function() {
        var selectedDays = $("#timeDropdown").val();
        $.get("/open_value", { days_ago: selectedDays }, function(data) {
          // Assuming you have an HTML element with id="openOpportunitiesValue" to display the value
          $("#openOpportunitiesValue").text(data.total);
        });

        $.get("/tier1_interactions", { days_ago: selectedDays }, function(data) {
          // Assuming you have an HTML element with id="tier1Value" to display the value
          $("#tier1Value").text(data.total);
        });

      });
    });

  </script>

  <script>// Function to update the display text when a button is clicked
  function updateDateRangeText(event) {
    // Grab the text of the clicked button
    let selectedText = event.target.innerText;

    // Update the display text
    document.querySelector(".text-65.medium").innerText = selectedText;

    // Submit the form
    event.target.closest("form").submit();
  }

  // Attach the click event listener to each button
  document.querySelectorAll(".small-dropdown-link").forEach(function(button) {
    button.addEventListener("click", updateDateRangeText);
  });
  </script>

  <script>
    // Create the modal instance once
    var sqlModal = new bootstrap.Modal(document.getElementById('sqlModal'));

    document.getElementById('openSqlModal').addEventListener('click', function() {
      sqlModal.show();
    });

    document.getElementById('saveSqlQuery').addEventListener('click', function() {
      const query = document.getElementById('sqlQueryInput').value;

      // Update the pill button text
      document.getElementById('openSqlModal').innerText = query;

      fetch(`/ask_sql?query=${encodeURIComponent(query)}`)
              .then(response => response.json())
              .then(data => {
                // Target the correct div to display the result
                document.querySelector('.display-4.sql').innerText = data.result;
                sqlModal.hide();
              });
    });

    $(document).ready(function() {
      $('.small-dropdown-link').on('click', function(event) {
        event.preventDefault();
        var accountId = $(this).attr('data-account-id');
        let tierValue = $(this).attr('value');

        // Update the dropdown toggle text to the selected tier immediately
        $(event.target).closest('.dropdown-container').find('.small-dropdown-toggle .text-65.medium').text(tierValue);

        $.post(`/update-tier/${accountId}`, {tier: tierValue}, function(response) {
          // If you want to handle the response from the server, you can do it here
          // For example:
          // if (!response.success) {
          //     alert('Error updating tier: ' + response.error);
          // }
        });

        return false; // Ensure the event doesn't propagate further
      });
    });
  </script>

  <script>
    let currentPage = 1;
    const feedContainer = document.getElementById('feedContainer');
    const loadingIndicator = document.getElementById('loadingIndicator');
    let isLoading = false;
    let hasMoreData = true;
    // var invitationModal = new bootstrap.Modal(document.getElementById('invitationModal'));

    function loadFeedItems() {
      if(isLoading) return;
      isLoading = true;
      loadingIndicator.style.display = 'block';

      fetch(`/feed?page=${currentPage}`)
              .then(response => response.json())
              .then(data => {

                // Clear the existing feed items
                feedContainer.innerHTML = '';

                appendDataToFeed(data);

                if (!data.recommendations.length && !data.events.length && !data.alerts.length && !data.meetings.length) {
                  hasMoreData = false;
                }

                currentPage++;
                isLoading = false;
                loadingIndicator.style.display = 'none';
              });
    }

    function appendDataToFeed(data) {
      const prependItems = (items, className) => {
        items.forEach(item => {
          const card = document.createElement('div');

          if (className === 'alert-card') {
            card.className = `card ${className}`;

            if (item.alert_contacts) {
              card.setAttribute('data-contact-ids', item.alert_contacts.join(','));
            }

            const cardHeader = document.createElement('div');
            cardHeader.className = 'card-header';
            card.appendChild(cardHeader)

            // create a span element
            const cardSpanDate = document.createElement('span');
            cardSpanDate.className = 'date'
            cardSpanDate.textContent = item.date;
            cardHeader.appendChild(cardSpanDate)

            const cardSpanTitle = document.createElement('span');
            cardSpanTitle.className = 'card-status-alert'
            cardSpanTitle.textContent = item.title;
            cardHeader.appendChild(cardSpanTitle)

            const cardBody = document.createElement('div');
            cardBody.className = 'card-body';

            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = item.text;

            cardBody.appendChild(contentDiv);

            const btn = document.createElement('button');
            // btn.className = 'btn btn-primary mt-2';
            btn.className = 'small-dropdown-toggle mt-4'
            btn.innerText = 'Contacts';

            btn.addEventListener('click', function() {
              var invitationModal = new bootstrap.Modal(document.getElementById('invitationModal'), {
                keyboard: true
              });
              invitationModal.show();

              var contactIds = card.getAttribute("data-contact-ids");

              if (contactIds) {
                contactIds = contactIds.split(',');

                fetch(`/get_contact_for_invite?contact_ids=${contactIds.join(',')}`)
                        .then(response => {
                          if (!response.ok) {
                            return Promise.reject('Fetch failed; it is not a 2xx response');
                          }
                          return response.json();
                        })
                        .then(data => {
                          var invitationModalBody = document.getElementById("invitationModalBody");
                          invitationModalBody.innerHTML = '';

                          let contactPromises = data.contacts.map(contact => {


                            return fetch(`/get_account_name?account_id=${contact.AccountId}`)
                                    .then(response => response.json())
                                    .then(accountData => {
                                      var contactCard = document.createElement("div");
                                      contactCard.className = "card";

                                      var cardBody = document.createElement("div");
                                      cardBody.className = "card-body";

                                      var cardText = document.createElement("p");
                                      cardText.className = "card-text";
                                      cardText.innerText = `Name: ${contact.Name}`;

                                      var accountText = document.createElement("p");
                                      accountText.className = "card-text";
                                      accountText.innerText = `Account: ${accountData.AccountName}`;

                                      var jobTitleText = document.createElement("p");
                                      jobTitleText.className = "card-text";
                                      jobTitleText.innerText = `Job Title: ${contact.Title}`;


                                      var checkbox = document.createElement("input");
                                      checkbox.type = "checkbox";
                                      checkbox.className = "form-check-input";
                                      checkbox.value = contact.Id;

                                      cardBody.appendChild(cardText);
                                      cardBody.appendChild(accountText);
                                      cardBody.appendChild(jobTitleText);
                                      cardBody.appendChild(checkbox);

                                      contactCard.appendChild(cardBody);

                                      invitationModalBody.appendChild(contactCard);
                                    })
                                    .catch(error => console.error('Error fetching account name:', error));
                          });

                          return Promise.all(contactPromises);
                        })
                        .catch(error => {
                          console.error('Fetch error:', error);
                        });

                // invitationModal.show();
              }
            });

            cardBody.appendChild(btn);
            card.appendChild(cardBody);
          } else {
            card.className = className;
            // card.innerHTML allows it to render as HTML
            card.innerHTML = item.text;
          }

          feedContainer.insertBefore(card, feedContainer.firstChild);
        });
      };

      prependItems(data.alerts, 'alert-card');
      prependItems(data.meetings, 'meeting-card');
    }

    // Initial load
    loadFeedItems();

    // Listen for scroll events
    window.onscroll = function() {
      if (hasMoreData && (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500) {
        loadFeedItems();
      }
    };

    document.addEventListener("DOMContentLoaded", function() {
      // Debugging
      console.log("DOMContentLoaded event fired.");

      // var invitationModal = new bootstrap.Modal(document.getElementById('invitationModal'));

      document.getElementById("sendInvitations").addEventListener("click", function() {
        // Debugging
        console.log("sendInvitations button clicked.");

        let selectedContacts = Array.from(document.querySelectorAll("input[type='checkbox']:checked")).map(checkbox => checkbox.value);

        // Debugging
        console.log("Selected contacts:", selectedContacts);

        fetch("/save_invitations", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            "selected_contacts": selectedContacts
          })

        })
                .then(response => {
                  // Debugging
                  console.log("Received response from server:", response);

                  return response.json();
                })
                .then(data => {
                  // Debugging
                  console.log("Received JSON data:", data);

                  if(data.status === "success") {
                    invitationModal.hide();
                    console.log("Modal should be hidden now.");  // Debugging line

                  } else {
                    console.error("Error sending invitations:", data.message);
                    console.log("Modal should be hidden now, but it's not.");  // Debugging line

                  }
                })
                .catch(error => {
                  console.error("Error:", error);
                });
      });

    });

  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      fetch("/api/events")
              .then(response => response.json())
              .then(data => {
                const eventContainer = document.getElementById("eventContainer");

                data.forEach(event => {
                  const eventDiv = document.createElement("div");
                  eventDiv.className = "event-item";

                  const dateContainer = document.createElement("div");
                  dateContainer.className = "date-container";



                  const eventDay = document.createElement("span");
                  eventDay.className = "event-day";
                  eventDay.innerText = new Date(event.start_time).getDate(); // Extracts the day
                  dateContainer.appendChild(eventDay);

                  const eventMonth = document.createElement("span");
                  eventMonth.className = "event-month";
                  eventMonth.innerText = new Date(event.start_time).toLocaleString('default', { month: 'short' }).toUpperCase(); // Extracts the month
                  dateContainer.appendChild(eventMonth);


                  eventDiv.appendChild(dateContainer);

                  const br = document.createElement("br");
                  eventDiv.appendChild(br);

                  const eventName = document.createElement("h2");
                  eventName.innerText = event.name;
                  eventDiv.appendChild(eventName);

                  const eventDescription = document.createElement("p");
                  eventDescription.innerText = event.description.toUpperCase();
                  eventDiv.appendChild(eventDescription);

                  const eventTimeLocation = document.createElement("p");
                  eventTimeLocation.innerText = `TIME | ${new Date(event.start_time).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}`;
                  eventDiv.appendChild(eventTimeLocation);

                  const eventLocation = document.createElement("p");
                  eventLocation.innerText = `LOCATION | ${event.city.toUpperCase()}, ${event.state}`;
                  eventDiv.appendChild(eventLocation);

                  // UNCOMMENT TO ADD BUTTON TO SEE CONTACTS
                  // eventDiv.appendChild(br);
                  //
                  // const contactsButton = document.createElement("button");
                  // contactsButton.className = "btn btn-primary";
                  // contactsButton.innerText = "See Contacts";
                  //
                  // const anchor = document.createElement("a");
                  // anchor.href = `#`;
                  // anchor.appendChild(contactsButton);
                  // eventDiv.appendChild(anchor);

                  eventContainer.appendChild(eventDiv);
                });
              })
              .catch(error => console.error("Error fetching events:", error));
    });
  </script>
  <script>
    // Existing code for like button click event
    document.addEventListener("DOMContentLoaded", function() {
      // Get all like buttons
      const likeButtons = document.querySelectorAll(".like-button");

      likeButtons.forEach((button) => {
        button.addEventListener("click", function(event) {
          const accountId = event.target.getAttribute("data-account-id");
          const targetButton = event.target; // Store reference to clicked button

          // Toggle the "clicked" class
          targetButton.classList.toggle("clicked");

          // Send AJAX request to route
          fetch("/account_focus", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ accountId: accountId }),
          })
                  .then(response => {
                    if (response.status === 400) {
                      // Remove the "clicked" class if status is 400
                      targetButton.classList.remove("clicked");
                    }
                    return response.json();  // Parse JSON body
                  })
                  .then(data => {
                    // Handle server response for /account_focus
                    console.log("Server response for /account_focus:", data);

                    // Reset currentPage to 1 and clear existing feed items
                    currentPage = 1;
                    feedContainer.innerHTML = '';

                    // Now fetch the new feed data
                    return fetch(`/feed?page=1`);
                  })
                  .then(response => response.json())  // Parse JSON body of feed
                  .then(data => {
                    // Update the feed with new data
                    appendDataToFeed(data);
                  })
                  .catch(error => {
                    console.error("Error:", error);
                    // Remove the "clicked" class in case of any other error
                    targetButton.classList.remove("clicked");
                  });

          console.log("Clicked star for account with ID: ", accountId);
        });
      });
    });

  </script>
  <script>
    $(document).ready(function() {
      var callModal = new bootstrap.Modal(document.getElementById('callModal'));

      document.getElementById('callButton').addEventListener('click', function() {
        callModal.show();
      });

      $('#contactSearch').autocomplete({
        source: '/search_contacts',
        minLength: 2,
        appendTo: "#callModal",
        select: function(event, ui) {
          // Fetch contact details
          $.ajax({
            url: '/get_contact_details/' + ui.item.value,
            success: function(contact) {
              console.log('Contact details:', contact);
              // Populate the call setup modal with contact details
              $('#contactName').text(contact.Name);
              $('#contactPhone').text(contact.Phone);
              $('#contactAccountId').text(contact.AccountId);
              $('#contactId').text(contact.ContactId);

              // Hide the current modal and show the call setup modal
              $('#callModal').modal('hide');
              $('#callSetupModal').modal('show');
            },
            error: function() {
              console.log('Error fetching contact details');
            }
          });
        }
      });
    });

  </script>
  <script>
    $('#startCallButton').click(function() {
      var contactName = $('#contactName').text();
      var contactPhone = $('#contactPhone').text();
      var accountId = $('#contactAccountId').text();
      var contactId = $('#contactId').text();
      console.log('Contact Account ID:', accountId);
      var recordCall = $('#recordCall').is(':checked');

      $.ajax({
        url: '/make_call',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          name: contactName,
          phone: contactPhone,
          record: recordCall,
          account_id: accountId,
          contact_id: contactId
        }),
        success: function(response) {
          $('#callSetupModal').modal('hide');
        },
        error: function(xhr, status, error) {
          alert("Error initiating call: " + xhr.responseText);
        }
      });
    });

  </script>

  <!-- Include the Socket.IO client library -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>

  <script type="text/javascript">
    const socket = io.connect('http://127.0.0.1:5000'); // Your Flask server URL

    socket.on('connect', function() {
      console.log('Connected to the server!');
    });

    socket.on('task_complete', function(data) {
      // Display a Bootstrap alert
      const alertHtml = `
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        ${data.message} <a href="/show_interactions" class="alert-link">View Interactions</a>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;
      document.body.insertAdjacentHTML('afterbegin', alertHtml);
    });
  </script>


  {% endblock %}